/* Page loads, sample buttons are autogenerated from an array

when enter is pressed or submit is clicked: the text entered into form field is added to button array and new button is created

clicking any of the buttons will return 10 STATIC giphy images with the rating underneath

clicking any of the giphy images once will make them play, clicking them again will make them stop playing

everytime a different button is clicked the previous search is cleared and replaced with the new search

when the clear button is pressed, the default array buttons are created, but user created buttons and images are cleared
*/

//document ready function
$(function() {


    var topics = ["Star Wars", "Jurassic Park", "Ghostbusters"];

    createButtons();


    //brings everything to default state on click
    $("#clear").on("click", function() {
        topics = ["Star Wars", "Jurassic Park", "Ghostbusters"];
        createButtons();
        $("#imagerow").html("");
    });

    //function to create buttons from array
    function createButtons() {
        $("#buttonrow").html("");
        for (i = 0; i < topics.length; i++) {
            $("#buttonrow").append("<button type='button' class='btn btn-danger'><i class='fa fa-play' aria-hidden='true'></i> " + topics[i] + "</button>")
        }
    }

    //toggles data-attribute between still and animated
    $("#imagerow").on("click", ".image", function() {
    	if($(this).attr("data-state") === 'still'){
    		$(this).attr("src", $(this).attr("data-animate"));
    		$(this).attr("data-state", "animate");
    	} else {
    		$(this).attr("src", $(this).attr("data-still"));
    		$(this).attr("data-state", "still");
    	}
    	
    	
    });



    //creates new button from search field, also clears search field
    $("#form").submit(function(event) {
        event.preventDefault();
        var $formValue = $("#giphySearch").val();
        if ($formValue.length > 0) {
            $("#form").trigger("reset");
            topics.push($formValue);
            createButtons();
        } else {
            console.log("Please enter a value");
        }
    });


    $("#buttonrow").on("click", ".btn-danger", function() {
        $("#imagerow").html("");

        $.ajax({

            //sets limit to 10 in url
            url: "http://api.giphy.com/v1/gifs/search?q=" + $(this).text() + "&api_key=dc6zaTOxFJmzC&limit=10",
            type: "GET",
            success: function(response) {
            	console.log(response);
                for (i = 0; i < response.data.length; i++) {
                    $("#imagerow").append("<figure><img class='image' data-state='still' data-animate='" + response.data[i].images.original.url + "' data-still='" + response.data[i].images.original_still.url +"' src='" + response.data[i].images.original_still.url + "'>" + "<figcaption> Rating:  <span class='text-uppercase'>" + response.data[i].rating + "</span></figcaption> </img></figure>")

                }
            }
        });


    });

});
